% !TEX TS-program = context (luatex)
% !TEX encoding = UTF-8 Unicode
% !TEX root = thesis.tex
% !TeX spellcheck = en-US
% !BIB program = bibtex
% @see https://tex.stackexchange.com/q/78101/34697

% Enable / Disable these to troubleshoot any layout issues.
% \showlayout
% \showsetups
% \showgrid
% \showmakeup
% \showframe
% \showbodyfontenvironment
\enabletrackers[fonts.missing]

\usemodule[visual]

\mainlanguage[en]

% @see http://wiki.contextgarden.net/Bibliography_mkiv
% \usebtxdataset[bibliography.bib]
% \usebtxdefinitions[apa]
% \setupbtx[default:cite][alternative=authoryear]
% @see https://tex.stackexchange.com/a/294571
\setupbibtex[database={bibliography},sort=author]
\setuppublications[alternative=apa]

% @see http://wiki.contextgarden.net/PDF_Bookmarks_and_Headers
% @see http://wiki.contextgarden.net/Command/setupinteraction
\setupinteraction[
    state=start,
    title={Your Thesis Title},
    author={The Author},
    color=black,
    contrastcolor=black,
    openaction=ToggleViewer,
    focus=width,
    click=yes,
]
\placebookmarks[chapter,section,subsection,subsubsection][chapter,section]
\setupinteractionscreen[option=bookmark]

\setuppapersize[A4][A4]
\setupbodyfont[times,12pt]
\setuplayout[
    backspace=4cm,
    topspace=1.25cm,
    header=1.25cm,
    footer=1.25cm,
    cutspace=2.5cm,
    height=middle,
    width=middle,
]

% @see http://wiki.contextgarden.net/Command/setupinterlinespace
% Double spacing is line=5.6ex and one and half spacing is line=4.2ex.
% However, closest we can get like MS Word 1.5 line spacing.
\setupinterlinespace[line=3.8ex]

% @see http://wiki.contextgarden.net/Command/setuppagenumbering
\setuppagenumbering[location={header,right},alternative=singlesided]

\setuplabeltext[chapter=CHAPTER~]
\setuphead[chapter][
    textstyle=cap,
    header=empty,
    alternative=middle,
    style=bold,
    numbercommand=\groupedcommand{\blank[1.5cm]}{\blank[4*line]},
    after={\blank[4*line]},
]

\setuphead[title][
    textstyle=cap,
    header=nomarking,
    style=bold,
    alternative=middle,
    style=bold,
]

% @see http://wiki.contextgarden.net/Command/setupindenting
% @see http://wiki.contextgarden.net/Indentation
% Indent all paragraph after all section headers.
\setupindenting[yes, 1.27cm, first]
\setupheads[section, subsection][
    indentnext=yes,
    numberwidth=1.27cm,
    style=bold,
    before={\blank[3*line]},
    after={\blank[1*line]}
]

\setupheads[subsubsection][
    indentnext=yes,
    numberwidth=1.27cm,
    style=bold,
    before={\blank[1*line]},
    after={\blank[1*line]}
]

% Appendices
\setuplabeltext[appendix=APPENDIX~]
\definehead[appendix][chapter]

\definelist[appendix][criterium=all]
\setuplist[appendix][
    alternative=b,
    margin=10mm,
    width=20mm,
    pagestyle={\word},
]

% @see https://tex.stackexchange.com/a/389791/141902
\definehspace[abbrwidth][1em]
\definesynonyms[abbreviation][abbreviations][\infull]
\setupsynonyms[abbreviation][
    criterium=all,
    textstyle=normal,
    synonymstyle=normal,
    width=3.5em,
    style={--\hspace[abbrwidth]},
    character=normal,
]

\starttext
\input 01_title

\startfrontmatter
    \definehead[headers][title]
    \setuphead[headers][
        style={\WORD\bf},
        incrementnumber=list,
    ]

    \setupheadtext[content=Table of Contents]
    \setuphead[title][incrementnumber=list]
    \setupcombinedlist[content][
        list={headers,title,chapter,section,subsection, subsubsection},
        alternative=b,
    ]

    \setuplist[headers][margin=0mm, style={\WORD\bf}, pagestyle={\word}, pagenumber=no, after={\blank[1*line]}]
    \setuplist[title][margin=30mm, style={\WORD\bf}, pagestyle={\word}]
    \setuplist[chapter][margin=10mm, width=20mm, style={\WORD\bf}, pagestyle={\word}]
    \setuplist[section][width=18mm, margin=30mm]
    \setuplist[subsection][width=18mm, margin=48mm]
    \setuplist[subsubsection][width=18mm, margin=66mm]

    \definestructureconversionset[frontpart:pagenumber][][romannumerals]
    \definestructureconversionset[bodypart:pagenumber][][numbers]

    \writetolist[headers]{}{Chapter \hfill Title \hfill Page}

    \setuppagenumber[number=2]
    \input 02_declaration
    \input 03_dedication

    % Resume the indentation formatting
    \setupindenting[yes, 1.27cm, first]
    \input 04_acknowledgement
    \input 05_abstract
    \input 06_abstrak

    \completecontent

    \input 07_listof

\stopfrontmatter

\setupwhitespace[line]
\startbodymatter
    \setuppagenumber[number=1]
    \input chapter01
    \input chapter02
    \input chapter03
    \input chapter06
\stopbodymatter

\startbackmatter
    \completepublications[criterium=all]
\stopbackmatter

\startappendices
    \appendix{Sample Appendix}
    \appendix{Another Appendix}
    \appendix{\fakewords{20}{30}}
\stopappendices

\stoptext
