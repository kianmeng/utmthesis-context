\startenvironment env_utmthesis
\project project_utmthesis

% Path to the components
\usepath[{frontmatter,bodymatter,backmatter}]

% ==========================================================================
% PDF
% ==========================================================================
% @see http://wiki.contextgarden.net/PDF_Bookmarks_and_Headers
% @see http://wiki.contextgarden.net/Command/setupinteraction
\setupinteraction[
    state=start,
    title={Your Thesis Title},
    author={The Author},
    color=black,
    contrastcolor=black,
    openaction=ToggleViewer,
    focus=width,
    click=yes,
]
\placebookmarks[chapter,section,subsection,subsubsection][chapter,section]
\setupinteractionscreen[option=bookmark]

% ==========================================================================
% Layout
% ==========================================================================
\setuppapersize[A4][A4]
\setupbodyfont[times,12pt]
\setuplayout[
    backspace=4cm,
    topspace=1.25cm,
    header=1.25cm,
    footer=1.25cm,
    cutspace=2.5cm,
    height=middle,
    width=middle,
]

% @see http://wiki.contextgarden.net/Command/setupinterlinespace
% Double spacing is line=5.6ex and one and half spacing is line=4.2ex.
% However, closest we can get like MS Word 1.5 line spacing.
\setupinterlinespace[line=3.8ex]

% @see http://wiki.contextgarden.net/Command/setuppagenumbering
\setuppagenumbering[location={header,right},alternative=singlesided]

% ==========================================================================
% Headers
% ==========================================================================
\setuplabeltext[chapter=CHAPTER~]
\setuphead[chapter][
    textstyle=cap,
    header=empty,
    alternative=middle,
    style=bold,
    numbercommand=\groupedcommand{\blank[1.5cm]}{\blank[4*line]},
    after={\blank[4*line]},
]

\setuphead[title][
    textstyle=cap,
    header=nomarking,
    style=bold,
    alternative=middle,
    style=bold,
]

% @see http://wiki.contextgarden.net/Command/setupindenting
% @see http://wiki.contextgarden.net/Indentation
% Indent all paragraph after all section headers.
\setupindenting[yes, 1.27cm, first]
\setupheads[section, subsection][
    indentnext=yes,
    numberwidth=1.27cm,
    style=bold,
    before={\blank[3*line]},
    after={\blank[1*line]}
]

\setupheads[subsubsection][
    indentnext=yes,
    numberwidth=1.27cm,
    style=bold,
    before={\blank[1*line]},
    after={\blank[1*line]}
]

% ==========================================================================
% Table of Contents
% ==========================================================================
\definehead[headers][title]
\setuphead[headers][
    style={\WORD\bf},
    incrementnumber=list,
]

\setupheadtext[content=Table of Contents]
\setuphead[title][incrementnumber=list]
\setupcombinedlist[content][
    list={headers,title,chapter,section,subsection, subsubsection},
    alternative=b,
]

\setuplist[headers][margin=0mm, style={\WORD\bf}, pagestyle={\word}, pagenumber=no, after={\blank[1*line]}]
\setuplist[title][margin=30mm, style={\WORD\bf}, pagestyle={\word}]
\setuplist[chapter][margin=10mm, width=20mm, style={\WORD\bf}, pagestyle={\word}]
\setuplist[section][width=18mm, margin=30mm]
\setuplist[subsection][width=18mm, margin=48mm]
\setuplist[subsubsection][width=18mm, margin=66mm]

\definestructureconversionset[frontpart:pagenumber][][romannumerals]
\definestructureconversionset[bodypart:pagenumber][][numbers]

% \writetolist[headers]{}{Chapter \hfill Title \hfill Page}

% ==========================================================================
% Table
% ==========================================================================
% @see https://tex.stackexchange.com/a/163744
% @see https://tex.stackexchange.com/a/44659
% @see https://adityam.github.io/context-blog/post/formatting-tables
\startsetups utm_table
   \setupTABLE[split=repeat,option=stretch,frame=on,loffset=1mm,roffset=1mm]
   \setupTABLE[row][first][style=bold]
\stopsetups

% @see https://tex.stackexchange.com/a/243726
\setupcaptions[table][location=top]

% ==========================================================================
% Abbreviation
% ==========================================================================
% @see https://tex.stackexchange.com/a/389791/141902
\definehspace[abbrwidth][1em]
\definesynonyms[abbreviation][abbreviations][\infull]
\setupsynonyms[abbreviation][
    criterium=all,
    textstyle=normal,
    synonymstyle=normal,
    width=3.5em,
    style={--\hspace[abbrwidth]},
    character=normal,
]

% ==========================================================================
% Appendices
% ==========================================================================
\setuplabeltext[appendix=APPENDIX~]
\definehead[appendix][chapter]

\definelist[appendix][criterium=all]
\setuplist[appendix][
    alternative=b,
    margin=10mm,
    width=20mm,
    pagestyle={\word},
]

% ==========================================================================
% Bibliography
% ==========================================================================
% @see http://wiki.contextgarden.net/Bibliography_mkiv
% \usebtxdataset[bibliography.bib]
% \usebtxdefinitions[apa]
% \setupbtx[default:cite][alternative=authoryear]
% @see https://tex.stackexchange.com/a/294571
\setupbibtex[database={bibliography},sort=author]
\setuppublications[alternative=apa]

\stopenvironment
